<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Itim&display=swap" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <link rel="icon" type="image/x-icon" href="./assets/Logo_last.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Playwrite+MX:wght@100..400&display=swap" rel="stylesheet" />
    <title>Activity_3</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            /* background-color: #678923; */
            /* min-height: 100vh; */
            background: url("assets/Backgrounds.png");
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            object-fit: cover;
min-height: 100vh;
        }

       #heading {
             text-align: center;
            background-color: whitesmoke;
            padding: 10px 20px; /* Increased padding: 15px top/bottom, 40px left/right */
            margin: 10px auto; /* Changed to auto for centering */
            color: black;
            font-size: 2em;
            font-weight: 600;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            width: fit-content; /* Changed from 40% to fit-content */
            border-radius: 10px; /* Added some border radius for better appearance */
        }

        .activity {
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            gap: 20px;
            height: auto;
        }

        .sidebar {
            width: 100px;
            height: fit-content;
            max-height: 65vh;
            overflow-y: auto;
        }

        .sidebar h3 {
            color: white;
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .questionButtons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .qBtn {
            padding: 12px 15px;
            border: none;
            border-radius: 10px;
            background-color: #f5f5f5; /* Grayish white background */
            color: black;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            width: 85%;
            text-align: center;
            box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.8); /* Dark shadow bottom right */
            position: relative;
        }

        .qBtn:hover {
            background-color: #e8e8e8;
            transform: translateY(-1px);
            box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.7);
        }

        .qBtn.active {
            background-color: #f5f5f5;
            box-shadow: none; /* Remove shadow when active */
            border: 3px solid #000; /* Dark black outline */
            transform: translateY(2px); /* Pressed effect */
        }

        .qBtn:active {
            box-shadow: none;
            border: 3px solid #000;
            transform: translateY(2px);
        }

        .mainContent {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .backGroundMainDiv {
            position: relative;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            min-height: 500px;
            flex: 1;
        }

        #backgroundImage {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 20px;
            opacity: 0.05;
            z-index: 1;
        }

        .questionContent {
            position: relative;
            z-index: 2;
        }

        .questionText {
            font-size: 1.8em;
            margin-bottom: 30px;
            color: #333;
            text-align: center;
            line-height: 1.4;
        }

        .middleSection {
            display: flex;
            /* gap: 40px; */
            align-items: flex-start;
            min-height: 350px;
        }

        /* Updated styles for input questions */
        .inputMiddleSection {
            display: flex;
            gap: 40px;
            align-items: flex-start;
            min-height: 300px;
        }

        .inputImageSection {
            flex: 0 0 40%; /* Fixed width of 40% */
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 20px;
        }

        .inputQuestionSection {
            flex: 0 0 60%; /* Fixed width of 60% */
            display: flex;
            flex-direction: column;
        }

        .inputQuestionText {
            font-size: 1.4em;
            margin-bottom: 20px;
            color: #333;
            line-height: 1.4;
            text-align: left;
        }

        .inputBottomSection {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-top: 30px;
        }

        .inputFeedbackSection {
            flex: 1;
        }

        .inputButtonSection {
            flex: 1;
            display: flex;
            justify-content: flex-end;
        }

        .imageSection {
            flex: 0 0 40%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .questionImg {
            max-width: 100%;
            max-height: 250px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .optionsSection {
    flex: 0 0 60%;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

/* New rule for when there's no image */
.middleSection:not(:has(.imageSection)) .optionsSection {
    flex: 0 0 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

/* Alternative approach using JavaScript class (if :has() is not supported) */
/* .optionsSection.full-width {
    flex: 1;
    max-width: 100%;
    align-items: center;
} */

.inputMiddleSection.no-image {
    display: block; /* Change from flex to block when no image */
}

.inputMiddleSection.no-image .inputQuestionSection {
    flex: none; /* Remove flex properties */
    width: 100%; /* Take full width */
}

        .optionGrid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .optionBtn {
            padding: 20px;
            border: 3px solid #ddd;
            border-radius: 15px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.6em;
            text-align: center;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            word-break: break-word;
            position: relative;
        }

        .optionBtn:hover {
            border-color: #667eea;
            background: #f8f9ff;
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .optionBtn.correct {
            background: #d4edda;
            border-color: #4CAF50;
            color: #155724;
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
        }

        .optionBtn.incorrect {
            background: #f8d7da;
            border-color: #f44336;
            color: #721c24;
            box-shadow: 0 8px 25px rgba(244, 67, 54, 0.4);
        }

        .optionImage {
            max-width: 250px;
            max-height: 250px;
            object-fit: contain;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .optionBtn.image-option {
            min-height: 250px;
            padding: 15px;
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
        }

        .optionBtn.image-option:hover {
            background: linear-gradient(145deg, #f8f9ff, #e8e9ff);
        }

        .optionBtn.image-option.correct {
            background: linear-gradient(145deg, #d4edda, #c3e6cb);
        }

        .optionBtn.image-option.incorrect {
            background: linear-gradient(145deg, #f8d7da, #f1c2c7);
        }

        /* Input field styles */
        .inputGrid {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 20px;
            align-items: center;
        }

        .inputContainer {
            display: flex;
            align-items: center;
            gap: 15px;
            width: 100%;
            max-width: 400px;
        }

        .inputLabel {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            min-width: 80px;
        }

        .answerInput {
            flex: 1;
            padding: 15px 20px;
            border: 3px solid #ddd;
            border-radius: 10px;
            font-size: 1.1em;
            text-align: center;
            transition: all 0.3s ease;
            background: white;
        }

        /* Inline input styles for questions */
        .inline-input {
            display: inline-block;
            width: 80px;
            padding: 8px 12px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 1.2em;
            text-align: center;
            margin: 0 5px;
            background: white;
            transition: all 0.3s ease;
        }

        .inline-input:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
        }

        .inline-input.correct {
            border-color: #4CAF50;
            background: #d4edda;
            color: #155724;
        }

        .inline-input.incorrect {
            border-color: #f44336;
            background: #f8d7da;
            color: #721c24;
        }

        .answerInput:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }

        .answerInput.correct {
            border-color: #4CAF50;
            background: #d4edda;
            color: #155724;
        }

        .answerInput.incorrect {
            border-color: #f44336;
            background: #f8d7da;
            color: #721c24;
        }

        .checkBtn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 20px auto;
            display: block;
        }

        .checkBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .feedbackText {
            font-size: 1.2em;
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
            min-height: 30px;
        }

        .emoji {
            font-size: 1.5em;
            margin-right: 10px;
        }

        .nextBtn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s ease;
            display: block;
            margin: 0 auto;
        }

        .nextBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(76, 175, 80, 0.4);
        }

        .finalScreen {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 400px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            border-radius: 20px;
            color: white;
            font-size: 2em;
            text-align: center;
        }

        .finalImage {
            max-width: 300px;
            border-radius: 15px;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .activity {
                flex-direction: column;
                height: auto;
            }

            .sidebar {
                width: 100%;
                max-height: 150px;
                margin-bottom: 20px;
            }

            .questionButtons {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
            }

            .qBtn {
                width: auto;
                min-width: 50px;
            }

            .middleSection, .inputMiddleSection {
                flex-direction: column;
                gap: 20px;
            }

            .inputImageSection, .inputQuestionSection {
                flex: 1 1 100%; /* Full width on mobile */
            }

            .inputBottomSection {
                flex-direction: column;
                gap: 15px;
            }

            .inputButtonSection {
                justify-content: center;
            }

            .questionText, .inputQuestionText {
                font-size: 1.2em;
            }

            .optionGrid {
                grid-template-rows: 1fr 1fr;
                gap: 15px;
            }

            .optionBtn {
                font-size: 1em;
                padding: 15px;
                min-height: 100px;
            }

            .optionBtn.image-option {
                min-height: 120px;
            }

            .optionImage {
                max-width: 200px;
                max-height: 200px;
            }

            .inputContainer {
                flex-direction: column;
                text-align: center;
            }

            .inputLabel {
                min-width: auto;
            }

            .inline-input {
                width: 60px;
                font-size: 1em;
            }
        }

        .optionGrid.three-options {
            grid-template-columns: 1fr 1fr;
        }

        .optionGrid.three-options .optionBtn:nth-child(3) {
            grid-column: 1 / -1;
        }

        .optionGrid.one-option {
            grid-template-columns: 1fr;
        }

        .optionGrid.has-images {
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .optionGrid.has-images .optionBtn {
            min-height: 160px;
            padding: 20px;
        }

        .optionGrid.has-images .optionImage {
            max-width: 260px;
            max-height: 160px;
        }

        @media (max-width: 768px) {
            .optionGrid.has-images {
                grid-template-columns: 1fr;
            }

            .optionGrid.has-images .optionBtn {
                min-height: 140px;
            }
        }

        .fraction-container {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            vertical-align: middle;
        }

        .whole-number {
            font-size: 1em;
        }

        .fraction {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            vertical-align: middle;
            font-size: 1em;
        }

        .numerator,
        .denominator {
            line-height: 1;
            padding: 2px 4px;
        }

        .fraction-line {
            width: 100%;
            height: 2px;
            background-color: currentColor;
            margin: 2px 0;
        }

        .questionText .fraction-container {
            margin: 0 4px;
        }

        .optionBtn .fraction-container {
            justify-content: center;
        }
    </style>
</head>

<body>
    <div class="header" style="
      width: auto;
      box-shadow: 5px 5px 10px rgb(0, 0, 0);
      padding-bottom: 10px;
      background-color: white;
    ">
        <img src="./assets/Logo.png" width="5%" style="float: left; margin-top: 25px; text-align: left"
            class="img-responsive" />
        <span>
            <img src="./assets/header.png" width="30%" height="" class="img-responsive" style="text-align: left" />
        </span>
    </div>
    <div>
            <p id="heading">Estimating Sums, Differences, Product and Quotients</p>
    </div>

    

    <div class="activity">
        <!-- Left Sidebar with Question Buttons -->
        <div class="sidebar">
            <div class="questionButtons" id="questionButtons"></div>
        </div>

        <!-- Main Content Area -->
        <div class="mainContent">
            <div class="backGroundMainDiv">
                <div id="questionContent" class="questionContent"></div>

                <div class="finalScreen" id="finalScreen" style="display:none;">
                    <div>
                        <h2>üéâ Well Done!</h2>
                        <p>You've completed all questions!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentIndex = 0;
        let selectedAnswer = null;
        let userInputs = [];
        let data = [
  {
    "questionNo": "Q1",
    "question": ["If a and b are both rounded up, then the approximate answer to a + b will be:"],
    "options": ["Larger", "Smaller"],
    "correct": 0
  },
  {
    "questionNo": "Q2",
    "question": ["If only b is rounded up, and a is not changed, then the approximate answer to:<br> a ‚àí b will be:"],
    "options": ["Larger", "Smaller"],
    "correct": 1
  },
  {
    "questionNo": "Q3",
    "question": ["If only b is rounded up, and a is not changed, then the approximate answer to<br> a √∑ b will be:"],
    "options": ["Larger", "Smaller"],
    "correct": 1
  },
  {
    "questionNo": "Q4",
    "question": ["If only b is rounded down, and a is not changed, then the approximate answer to<br> a ‚àí b will be:"],
    "options": ["Larger", "Smaller"],
    "correct": 0
  },
  {
    "questionNo": "Q5",
    "question": ["If only b is rounded down, and a is not changed, then the approximate answer to<br> a √∑ b will be:"],
    "options": ["Larger", "Smaller"],
    "correct": 0
  },
  {
    "questionNo": "Q6",
    "question": ["A school library had 563 books. They received a donation of 289 more books. How many books does the library have now? Choose the better estimate."],
    "options": ["900", "800", "700", "600"],
    "correct": 0
  },
  {
    "questionNo": "Q7",
    "question": ["Laila had 1,925 marbles in her collection. She gave away 856 marbles to her friends. How many marbles does she have now? Choose the better estimate."],
    "options": ["1,200", "1,100", "900", "1,000"],
    "correct": 3
  },
  {
    "questionNo": "Q8",
    "question": ["Ryan collected 1,267 trading cards. His friend gave him 732 more cards. How many cards does Ryan have now? Choose the better estimate."],
    "options": ["1,000", "2,000", "1,700", "1,300"],
    "correct": 1
  },
  {
    "questionNo": "Q9",
    "question": ["Sara subtracts two numbers and gets a difference that rounds to 40 when rounded to the nearest ten. Which could be her numbers?"],
    "options": ["96 and 43", "92 and 47", "88 and 39", "81 and 37"],
    "correct": 3
  },
  {
    "questionNo": "Q10",
    "question": ["What is the estimated product of 47 and 693? Round the numbers to the nearest ten and hundred, respectively."],
    "options": ["30,000", "35,000", "40,000", "40,000"],
    "correct": 1
  },
  {
    "questionNo": "Q11",
    "question": ["Shanzay eats 2,004 calories every day. About how many calories she eats in a week by rounding the daily intake to the nearest ten."],
    "options": ["15,900", "14,000", "17,400", "16,100"],
    "correct": 1
  },
  {
    "questionNo": "Q12",
    "question": ["A factory produces 742 pens every hour. If the factory operates for 48 hours, how many pens are produced? Estimate the number of pens. Also find the difference between the estimate and the actual number of pens."],
    "options": ["35,000 (Difference = 616)", "40,000 (Difference = 384)", "45,000 (Difference = 884)", "50,000 (Difference = 984)"],
    "correct": 0
  },
  {
    "questionNo": "Q13",
    "question": ["Harry multiplies a number by 4 and gets a result that rounds to 40 when rounded to the nearest ten. What number could he have started with?"],
    "options": ["8", "9", "12", "7"],
    "correct": 1
  },
  {
    "questionNo": "Q14",
    "question": ["A toy factory needs to pack 4,186 toy cars into boxes. If each box holds 7 toy cars, estimate how many boxes will they need?(Use compatible number)<br> Also find the difference between the estimated and actual number of boxes."],
    "options": ["500 (Difference = 96)", "600 (Difference = 2)", "700 (Difference = 99)", "800 (Difference = 199)"],
    "correct": 1
  },
  {
    "questionNo": "Q15",
    "question": ["A printer has 5,928 pages to print and each ink cartridge can print about 6 pages. Estimate how many cartridges are needed.(Use compatible number)<br> Also find the difference between the estimate and the actual number of cartridges."],
    "options": ["800 (Difference = 212)", "1,000 (Difference = 12)", "900 (Difference = 79)", "700 (Difference = 288)"],
    "correct": 1
  },
  {
    "questionNo": "Q16",
    "question": ["A farmer harvested 1,482 apples and wants to pack them equally into 28 boxes.<br> About how many apples will go in each box?<br><i> (Estimate by rounding both numbers to friendly numbers.)</i>"],
    "options": ["50", "40", "30", "60"],
    "correct": 0
  },
  {
    "questionNo": "Q17",
    "question": ["Ben divides a number by 5 and gets a result that rounds to 60 when rounded to the nearest ten. What number could he have started with?"],
    "options": ["270", "305", "340", "360"],
    "correct": 1
  },
  {
    "questionNo": "Q18",
    "question": ["Priya bought three items priced at $12.75, $9.45, and $7.80.<br> She wants to estimate the total cost before checkout by rounding to the nearest whole number.<br>What is the best estimate of her total bill?"],
    "options": ["$30", "$28", "$27", "$29"],
    "correct": 0
  },
  {
    "questionNo": "Q19",
    "question": ["A car rental charges $42.65 per day, and another agency charges $38.30 per day. Estimate how much more expensive the first company is by rounding both to the nearest whole number."],
    "options": ["$3", "$4", "$5", "$6"],
    "correct": 2
  },
  {
    "questionNo": "Q20",
    "question": ["A pack of protein bars costs $2.89 and you want to buy 14 of them. Estimate the total cost by rounding the price to the nearest whole number."],
    "options": ["$28", "$42", "$40", "$50"],
    "correct": 1
  },
  {
    "questionNo": "Q21",
    "question": ["A hiker has 17.75 liters of water and plans to equally divide it among 3 bottles. Estimate how much water will go in each bottle, rounded the amount of water to the nearest whole number first."],
    "options": ["3 liters", "4 liters", "5 liters", "6 liters"],
    "correct": 3
  },
  {
    "questionNo": "Q22",
    "question": ["Anna bought 3 smoothie bottles priced at $4.36, $5.84, and $3.27. She wants to estimate the total cost by rounding each price to the nearest tenth. What is the best estimate of the total cost?"],
    "options": ["$13.5", "$13.4", "$13.6", "$13.7"],
    "correct": 0
  },
  {
    "questionNo": "Q23",
    "question": ["A runner clocked two times: 14.786 minutes and 13.459 minutes in two races. Estimate how much faster the second run was by rounding both to the nearest hundredth."],
    "options": ["1.32 min", "1.33 min", "1.31 min", "1.30 min"],
    "correct": 1
  },
  {
    "questionNo": "Q24",
    "question": ["A paint can contains 2.26 L, and a painter uses 2.7 cans. Estimate the total paint used by rounding each number to the nearest tenth."],
    "options": ["6.11", "6.21", "6.22", "6.51"],
    "correct": 1
  },
  {
    "questionNo": "Q25",
    "question": ["A tank contains 9.362 liters of fuel. Each machine uses 3.117 liters per cycle.<br>Estimate how many full cycles the fuel can support by rounding each number to the nearest hundredth before dividing."],
    "options": ["3", "2.9", "3.1", "3.2"],
    "correct": 0
  }
]

        window.onload = () => {
            renderButtons();
            renderQuestion();
        };

        function renderButtons() {
            const container = document.getElementById('questionButtons');
            container.innerHTML = '';
            data.forEach((item, index) => {
                const btn = document.createElement('button');
                btn.innerText = item.questionNo;
                btn.className = 'qBtn' + (index === currentIndex ? ' active' : '');
                btn.onclick = () => {
                    currentIndex = index;
                    selectedAnswer = null;
                    userInputs = [];
                    renderQuestion();
                };
                container.appendChild(btn);
            });
            setTimeout(() => {
                const activeBtn = container.querySelector('.qBtn.active');
                if (activeBtn) {
                    activeBtn.scrollIntoView({
                        behavior: 'smooth',
                        block: 'nearest',
                        inline: 'center'
                    });
                }
            }, 100);
        }

        function processQuestionContent(questionContent) {
            if (typeof questionContent === 'string') {
                return questionContent;
            }

            if (Array.isArray(questionContent)) {
                return questionContent.map(item => {
                    if (typeof item === 'string') {
                        return item;
                    } else if (item.fraction) {
                        return renderFraction(item.fraction);
                    }
                    return '';
                }).join('');
            }

            return questionContent;
        }

        function renderFraction(fractionObj) {
            const { whole, numerator, denominator } = fractionObj;

            let html = '<span class="fraction-container">';

            if (whole && whole > 0) {
                html += `<span class="whole-number">${whole}</span>`;
            }

            if (numerator && denominator) {
                html += `<span class="fraction">
                    <span class="numerator">${numerator}</span>
                    <span class="fraction-line"></span>
                    <span class="denominator">${denominator}</span>
                </span>`;
            }

            html += '</span>';
            return html;
        }

        function restrictInput(event) {
            const allowedChars = /[0-9+\-x\/\.\s]/;
            const char = String.fromCharCode(event.which);
            
            if ([8, 9, 27, 13, 46].indexOf(event.keyCode) !== -1 ||
                (event.keyCode === 65 && event.ctrlKey === true) ||
                (event.keyCode === 67 && event.ctrlKey === true) ||
                (event.keyCode === 86 && event.ctrlKey === true) ||
                (event.keyCode === 88 && event.ctrlKey === true)) {
                return;
            }
            
            if (!allowedChars.test(char)) {
                event.preventDefault();
            }
        }

        function renderQuestion() {
    const questionContent = document.getElementById('questionContent');
    const finalScreen = document.getElementById('finalScreen');
    const questionButtons = document.getElementById('questionButtons');

    if (currentIndex >= data.length) {
        questionContent.style.display = 'none';
        questionButtons.style.display = 'none';
        finalScreen.style.display = 'flex';
        return;
    }

    const q = data[currentIndex];
    let html = '';

    // Check if this question has input fields
    if (q.input) {
                // Input question layout
                const hasImage = q.image ? true : false;
    const sectionClass = hasImage ? 'inputMiddleSection' : 'inputMiddleSection no-image';
    
    html += `<div class='${sectionClass}'>`;
                
                // Left side - Image (if exists)
                if (q.image) {
                    html += `<div class="inputImageSection">
                                <img src="${q.image}" alt="question" class="questionImg"/>
                             </div>`;
                }

                 html += `<div class="inputQuestionSection">`;
    
    // Process question content and replace _____ with input fields
    let questionText = processQuestionContent(q.question);
    let inputIndex = 0;
    questionText = questionText.replace(/_____/g, () => {
        return `<input type="text" class="inline-input" id="input_${inputIndex++}" placeholder="" onkeypress="restrictInput(event)" />`;
    });
    
    html += `<div class='questionText'>${questionText}</div>`;
    html += `</div>`; // Close inputQuestionSection
    html += `</div>`; // Close inputMiddleSection

    // Bottom section with feedback and submit button
    html += `<div class='inputBottomSection'>`;
    html += `<div class='inputFeedbackSection'>
                <p class="feedbackText" id="feedbackText"></p>
             </div>`;
    html += `<div class='inputButtonSection'>
                <button class="checkBtn" onclick="handleInputCheck()">Submit</button>
                <button class="nextBtn" id="nextBtn" style="display:none;" onclick="handleNext()">Next</button>
             </div>`;
    html += `</div>`;

            } else {
        // Regular option question layout
        let questionText = processQuestionContent(q.question);
        html += `<h3 class='questionText'>${questionText}</h3>`;
        html += `<div class='middleSection'>`;

        // Left side - Image (only if exists)
        if (q.image) {
            html += `<div class="imageSection">
                        <img src="${q.image}" alt="question" class="questionImg"/>
                     </div>`;
        }

        // Right side - Options and feedback (full width if no image)
        html += `<div class="optionsSection${!q.image ? ' full-width' : ''}">`;

        const hasImages = q.options.some(opt => typeof opt === 'string' && /\.(png|jpe?g|svg)$/i.test(opt));
        let gridClass = 'optionGrid';
        if (hasImages) {
            gridClass += ' has-images';
        }
        if (q.options.length === 1) {
            gridClass += ' one-option';
        } else if (q.options.length === 3) {
            gridClass += ' three-options';
        }

        html += `<div class="${gridClass}">`;
        q.options.forEach((opt, idx) => {
            const isImage = typeof opt === 'string' && /\.(png|jpe?g|svg)$/i.test(opt);
            const buttonClass = isImage ? 'optionBtn image-option' : 'optionBtn';
            html += `<button class="${buttonClass}" onclick="handleOptionClick(${idx})">`;

            if (isImage) {
                html += `<img src="assets/${opt}" alt="option-${idx}" class="optionImage"/>`;
            } else if (opt.fraction) {
                html += renderFraction(opt.fraction);
            } else {
                html += opt;
            }

            html += `</button>`;
        });

        html += `</div>`;
        html += `<div style='display:flex'><div style='width:50%'><p class="feedbackText" id="feedbackText"></p></div>
                 <div style='width:50%'><button class="nextBtn" id="nextBtn" style="display:none;" onclick="handleNext()">Next</button></div></div>
                 </div></div>`;
    }

    questionContent.innerHTML = html;
    
    // Add event listeners to input fields after they're created
    if (q.input) {
        for (let i = 0; i < q.input.length; i++) {
            const inputElement = document.getElementById(`input_${i}`);
            if (inputElement) {
                inputElement.addEventListener('paste', function(event) {
                    event.preventDefault();
                    const paste = (event.clipboardData || window.clipboardData).getData('text');
                    const filtered = paste.replace(/[^0-9+\-x\/\.\s]/g, '');
                    this.value = filtered;
                });
                
                inputElement.addEventListener('input', function(event) {
                    this.value = this.value.replace(/[^0-9+\-x\/\.\s]/g, '');
                });
            }
        }
    }

    questionContent.style.display = 'block';
    finalScreen.style.display = 'none';
    renderButtons();
}

        function handleInputCheck() {
            const q = data[currentIndex];
            const feedback = document.getElementById('feedbackText');
            const nextBtn = document.getElementById('nextBtn');
            const checkBtn = document.querySelector('.checkBtn');

            userInputs = [];
            let allCorrect = true;

            for (let i = 0; i < q.input.length; i++) {
                const inputElement = document.getElementById(`input_${i}`);
                const userValue = inputElement.value.trim().toLowerCase();
                userInputs.push(userValue);

                const correctAnswer = q.correct[i].trim().toLowerCase();
                const isCorrect = userValue === correctAnswer;

                if (isCorrect) {
                    inputElement.classList.remove('incorrect');
                    inputElement.classList.add('correct');
                } else {
                    inputElement.classList.remove('correct');
                    inputElement.classList.add('incorrect');
                    allCorrect = false;
                }
            }

            if (allCorrect) {
                feedback.innerHTML = `<span class='emoji'>‚úÖ</span> Correct! Great job!`;
                feedback.style.color = '#4CAF50';

                for (let i = 0; i < q.input.length; i++) {
                    document.getElementById(`input_${i}`).disabled = true;
                }
                checkBtn.style.display = 'none';

                nextBtn.innerText = currentIndex + 1 < data.length ? 'Next' : 'Finish';
                nextBtn.style.display = 'block';
            } else {
                feedback.innerHTML = `<span class='emoji'>‚ùå</span> Some answers are incorrect. Try again!`;
                feedback.style.color = '#f44336';
            }
        }


        function handleOptionClick(index) {
            if (selectedAnswer !== null) return; // Prevent multiple selections

            selectedAnswer = index;
            const q = data[currentIndex];
            const feedback = document.getElementById('feedbackText');
            const nextBtn = document.getElementById('nextBtn');
            const optionBtns = document.querySelectorAll('.optionBtn');

            // Disable further selection temporarily
            optionBtns.forEach((btn) => {
                btn.style.pointerEvents = 'none';
            });

            if (index === q.correct) {
                // Highlight selected correct answer
                optionBtns[index].classList.add('correct');

                feedback.innerHTML = `<span class='emoji'>‚úÖ</span> Correct! Great job!`;
                feedback.style.color = '#4CAF50';

                nextBtn.innerText = currentIndex + 1 < data.length ? 'Next' : 'Finish';
                nextBtn.style.display = 'block';
            } else {
                // Highlight only incorrect answer clicked
                optionBtns[index].classList.add('incorrect');

                feedback.innerHTML = `<span class='emoji'>‚ùå</span> Try again!`;
                feedback.style.color = '#f44336';

                // Re-enable the buttons so user can try again
                optionBtns.forEach((btn, idx) => {
                    if (idx !== index) {
                        btn.style.pointerEvents = 'auto';
                    }
                });

                // Reset selectedAnswer so user can choose again
                selectedAnswer = null;
            }
        }

        function handleNext() {
            if (currentIndex + 1 < data.length) {
                currentIndex++;
                selectedAnswer = null;
                userInputs = [];
                renderQuestion();
            } else {
                currentIndex++;
                renderQuestion();
            }
        }
    </script>
</body>

</html>
